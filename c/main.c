#include <gmp.h>
#include <stdio.h> 
#include <time.h>
#include <assert.h>
#include <stdlib.h>
#include "prime_test.h"
#include "factoring.h"

int main(int argc, char **argv){

    assert(argc == 3);
    int max_time = atoi(argv[1]);
    bool rand = atoi(argv[2]);

    mpz_t n;
    mpz_init(n);
    if (rand){
        gmp_randstate_t state;
        gmp_randinit_default(state);
        gmp_randseed_ui(state, time(NULL));

        mpz_urandomb(n, state, 5000);        
    }

    else{
        gmp_fscanf(stdin, "%Zd", n);

    }

    // Prime test
    if (probable_prime_test(n)){
        gmp_printf("%Zd is probably prime\n", n);
        return 0;
    }

    mpz_t a, b;
    mpz_init(a);
    mpz_init(b);

    // ALGO PAGE 59
    /*
    fermat_naive(n, a, b);
    gmp_printf("n = %Zd * %Zd\n", a, b);
    */

    // ALGO PAGE 65
    int c = 1;
    clock_t start = clock();
    clock_t stop = clock();
    while((stop - start)/CLOCKS_PER_SEC < max_time){

        if (brent_pollard_rho(n, c, 10000, a)){
            if (mpz_divisible_p(n, a)){
                mpz_divexact(b, n, a);
                gmp_printf("n = %Zd * %Zd\n", a, b);
                return 0;
            }
        }
        c += 1;

        stop = clock();
    }

    return 0;
}


/*GOOD NUMBERS

16075436350318561293729271963123777540892808661430
62136812841057897233672905871581363084656454309120
67799781178602635102720830994780749397124604711907
47498380749816435625536974194372221377961901530436
25180012603844175640001713472973037081585107042347
47353420843228273585937281385577256094841373754331
65028110827570474505514566180282451932160963637956
27939282978713739992844457518835436236193005347070
71756283865249795354926332647945279749091997097968
59570848195731540896019228126012775652550472092315
42227942027875757680398233836099298233580479900044
69126672572747996924477552667704417145612210428738
40465208538123625135431663801999862950961090566810
90615681162609397512440221912994661542574896366232
58539561865014910847630502674579145412064120349600
84801425589310438690486760782583792132261034969288
20297729488285615880127052037145884764215566124790
89357717091590154024830914511208530819296232952542
13482792948322745581192733373680383920116275105350
58542838331587619089155673869067179054591949116490
91499523048346251245699139344976214495911131800921
68933284090714253743543780545798941148904554324560
80598241088883707625604506455007942586596418571858
78673818949255416579846256487870650674354141747443
66632468476041285400550942574174967046835846424718
62724335250970090185684927018910912222163270684734
79366781798021087767987338273534708893861264975652
03012988938014241008041888132538485032884718747673
74523768566286568862739397070822873108958838157656
3517324903995778185195427338584589


76948205484452326439620792792340232451319072324722
77215327152923944986863358737267628268531339492090
59760831956530037334107216847008926033573345102693
68024084966935823663327421294256322967517848162757
52497328999732603067298485211391980372870011935083
92962786261032879260442370733370565804931733382077
63608252347872812598665612797798167430351309019437
53397072307927890356475857186837895247069301323319
47977943690658037264356963815490867343397590810915
64905499037669344554645504631939070503350040158929
87076552094049236731566370711248185367991035871003
30376238394343711948927804198827594019923243876286
02101563516513360207662092308215060716322628766619
97273662677219351890262379965955371833530037427916
41710266658003140709623077036516822963785438431892
48403655298903295176025894385307941151796814514873
75185470311304218018493490700612441135205310072019
97480662820747983184066138434787613430699961043636
86216635238691207121165170166932651267275167289554
59740455829211590503726358673207157480101996576930
95907700868651579686611505623286607031892927397038
74431578148236075525742436822265090030773876779872
52267994684102850523465919774591775735368311544389
60381428661280758417240081089269366285923460317385
81645251046350702771168714054006575530073969552413
66897391460217874107040449655075127564617834860194
39433522155696013792366569626523325916719157745033
08767245400709865962598074672761306359561956479301
59203542650243945443855336314295834358320681266171
20854020561729270545073867874679354944583222503


// Product of big primes
19488684264759095808522956666290465810540813435172
71279952221052088685584859418556624147446136712530
27013347378718661946636748303020254523540374555070
19635897398047834278780728850707335150014968886475
9063720703111
*/