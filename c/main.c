#include <gmp.h>
#include <stdio.h> 
#include <time.h>
#include <assert.h>
#include <stdlib.h>
#include "prime_test.h"
#include "factoring.h"
#include "dixon/dixon.h"

#define MAX_POLLARD_RHO 10

int main(int argc, char **argv){

    assert(argc == 2);
    bool rand = atoi(argv[1]);

    mpz_t n;
    mpz_init(n);
    if (rand){
        gmp_randstate_t state;
        gmp_randinit_default(state);
        gmp_randseed_ui(state, time(NULL));

        mpz_urandomb(n, state, 200);        
    }

    else{
        gmp_fscanf(stdin, "%Zd", n);

    }

    // Prime test
    if (probable_prime_test(n)){
        gmp_printf("%Zd is probably prime\n", n);
        return 0;
    }

    mpz_t a;
    mpz_init(a);

    /*
    // ALGO PAGE 59
    fermat_naive(n, a, b);
    gmp_printf("n = %Zd * %Zd\n", a, b);
    return 0;
    */

    // ALGO PAGE 65
    int c = 1;
    clock_t start = clock();
    clock_t stop;
    int exec_time;

    while(exec_time < MAX_POLLARD_RHO){

        if (brent_pollard_rho(n, c, 100000, a)){
            if (mpz_divisible_p(n, a)){
                gmp_printf("Pollard_rho found: %Zd = 0 [%Zd]\n", n, a);
                return 0;
            }
        }
        c += 1;

        stop = clock();
        exec_time = (stop - start)/CLOCKS_PER_SEC;
    }
    gmp_printf("Pollard rho failed\n n = %Zd", n);

    // ALGO PAGE JSP
    dixon(n, 10000);

    return 0;
}


/*GOOD NUMBERS
16075436350318561293729271963123777540892808661430621368128410578972336729058715813630846564543091206779978117860263510272083099478074939712460471190747498380749816435625536974194372221377961901530436251800126038441756400017134729730370815851070423474735342084322827358593728138557725609484137375433165028110827570474505514566180282451932160963637956279392829787137399928444575188354362361930053470707175628386524979535492633264794527974909199709796859570848195731540896019228126012775652550472092315422279420278757576803982338360992982335804799000446912667257274799692447755266770441714561221042873840465208538123625135431663801999862950961090566810906156811626093975124402219129946615425748963662325853956186501491084763050267457914541206412034960084801425589310438690486760782583792132261034969288202977294882856158801270520371458847642155661247908935771709159015402483091451120853081929623295254213482792948322745581192733373680383920116275105350585428383315876190891556738690671790545919491164909149952304834625124569913934497621449591113180092168933284090714253743543780545798941148904554324560805982410888837076256045064550079425865964185718587867381894925541657984625648787065067435414174744366632468476041285400550942574174967046835846424718627243352509700901856849270189109122221632706847347936678179802108776798733827353470889386126497565203012988938014241008041888132538485032884718747673745237685662865688627393970708228731089588381576563517324903995778185195427338584589

769482054844523264396207927923402324513190723247227721532715292394498686335873726762826853133949209059760831956530037334107216847008926033573345102693680240849669358236633274212942563229675178481627575249732899973260306729848521139198037287001193508392962786261032879260442370733370565804931733382077636082523478728125986656127977981674303513090194375339707230792789035647585718683789524706930132331947977943690658037264356963815490867343397590810915649054990376693445546455046319390705033500401589298707655209404923673156637071124818536799103587100330376238394343711948927804198827594019923243876286021015635165133602076620923082150607163226287666199727366267721935189026237996595537183353003742791641710266658003140709623077036516822963785438431892484036552989032951760258943853079411517968145148737518547031130421801849349070061244113520531007201997480662820747983184066138434787613430699961043636862166352386912071211651701669326512672751672895545974045582921159050372635867320715748010199657693095907700868651579686611505623286607031892927397038744315781482360755257424368222650900307738767798725226799468410285052346591977459177573536831154438960381428661280758417240081089269366285923460317385816452510463507027711687140540065755300739695524136689739146021787410704044965507512756461783486019439433522155696013792366569626523325916719157745033087672454007098659625980746727613063595619564793015920354265024394544385533631429583435832068126617120854020561729270545073867874679354944583222503

1969436090884611026857478677620575714724951738418199523386202513988817624731068225558491082262546464920812801958306459276635610683550543228574333515100620975732969675295445344415647021135852003516954615386863583896897058870224790786021774823080220159362011578228862396685472883785395168893204393317053958267443966745170147909089261604810407121154303852246823214221237792476545212062203601278237294064708553688702956361616868138777603150250421518730666117799119689339659886242994908590230635352730015598335209726625404505775426910627350273914742918008511217854699644298961110297718266306644550904652276486420171628635717875652734660594488243186417570167804512564659649900057146707053468029631826666999140560887206125646651086323011691639543934363226436813932216962043714702452896848385174535000692621691219209253526824719635651660467070861625343095849778703056281631191053241571288061514071838647106676262599423190535466069517075289523287272120484017039594393224431952222934960994417223178018560717693069979572850733228234322497030830140877615963247516750129409463458328598360976965550355637054214945876623080992641879432942943745562676699954979794814439884951719536730855958146396724521350704023310315899223463237960274577711238552991614340409303270905901396615572137729697620058474643620965825726271853194529496979651852804602615456770982097479196599001880842848956460871688257077260177187681282886902963325909392044987477623570467642693211083712455765193733146547039581157398291970835185941953256517

// Product of big primes
194886842647590958085229566662904658105408134351727127995222105208868558485941855662414744613671253027013347378718661946636748303020254523540374555070196358973980478342787807288507073351500149688864759063720703111

706113762068412435747683199935230839398684490635512212296530712933315635896349355029272628861810919
*/